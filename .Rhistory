) +
theme_minimal()
ggplot(pwt, aes(year, growth, color = country)) +
geom_line(alpha = 0.3) +                 # faint raw data
geom_smooth(se = FALSE, span = 0.3) +    # smooth trend
labs(
title = "Real GDP Growth Rates (%) â€“ North America (Smoothed)",
y = "Growth Rate (%)",
x = "Year"
) +
theme_minimal()
ggplot(pwt, aes(year, growth, color = country)) +
geom_line(alpha = 0.3) +                 # faint raw data
geom_smooth(se = FALSE, span = 0.3) +    # smooth trend
scale_x_continuous(breaks = seq(min(pwt$year), max(pwt$year), by = 5)) +
labs(
title = "Real GDP Growth Rates (%) â€“ North America (Smoothed)",
y = "Growth Rate (%)",
x = "Year"
) +
theme_minimal()
ggplot(pwt, aes(year, growth, color = country)) +
geom_line(alpha = 0.3) +                 # faint raw data
geom_smooth(se = FALSE, span = 0.3) +    # smooth trend
scale_x_continuous(breaks = seq(min(pwt$year), max(pwt$year), by = 10)) +
labs(
title = "Real GDP Growth Rates (%) â€“ North America (Smoothed)",
y = "Growth Rate (%)",
x = "Year"
) +
theme_minimal()
# Empty Environment
rm(list=ls())
# install.packages("ggplot2")
# install.packages("pwt10")
# install.packages("dplyr")
# This is the standard way to load packages in R
library(pwt10)
# Load data into environment from our package
pwt <- pwt10::pwt10.0
# Filter for relevant countries
# Calculate growth rate
# Calculate GDP Per Capita
pwt <- pwt %>%
filter(isocode %in% c("MEX", "CAN", "USA")) %>%
group_by(country) %>%
arrange(year) %>%
mutate(growth = 100 * (rgdpe - lag(rgdpe)) / lag(rgdpe),
rgdpcapita = rgdpe/pop)
# Plot GDP Per Capita
ggplot(pwt, aes(year, rgdpcapita, color = country)) +
geom_line() +
labs(
title = "Real GDP per Capita â€“ North America",
y = "GDP Per Capita",
x = "Year"
) +
theme_minimal()
# Plot growth rates
ggplot(pwt, aes(year, growth, color = country)) +
geom_line() +
labs(
title = "Real GDP Growth Rates (%) â€“ North America",
y = "Growth Rate (%)",
x = "Year"
) +
theme_minimal()
# Note that growth rate is a little noisy.
# We can smooth out to visualize trend better
ggplot(pwt, aes(year, growth, color = country)) +
geom_line(alpha = 0.3) +                 # faint raw data
geom_smooth(se = FALSE, span = 0.3) +    # smooth trend
scale_x_continuous(breaks = seq(min(pwt$year), max(pwt$year), by = 10)) +
labs(
title = "Real GDP Growth Rates (%) â€“ North America (Smoothed)",
y = "Growth Rate (%)",
x = "Year"
) +
theme_minimal()
# Correlation Between GDP per Capita & Investment Share
ggplot(pwt, aes(rgdpcapita, csh_i, color = country)) +
geom_point(alpha = 0.5) +
geom_smooth(se = FALSE) +
labs(
title = "Investment Share vs GDP Per Capita",
x = "GDP Per Capita",
y = "Investment Share of GDP (csh_i)"
) +
theme_minimal()
# Correlation Between GDP per Capita & Investment Share
ggplot(pwt, aes(rgdpcapita, csh_i, color = country)) +
geom_point(alpha = 0.5) +
labs(
title = "Investment Share vs GDP Per Capita",
x = "GDP Per Capita",
y = "Investment Share of GDP (csh_i)"
) +
theme_minimal()
# Correlation Between GDP per Capita & Investment Share
ggplot(pwt, aes(rgdpcapita, csh_i, color = country)) +
geom_point(alpha = 0.5) +
geom_line(se = FALSE) +
labs(
title = "Investment Share vs GDP Per Capita",
x = "GDP Per Capita",
y = "Investment Share of GDP (csh_i)"
) +
theme_minimal()
# Correlation Between GDP per Capita & Investment Share
ggplot(pwt, aes(rgdpcapita, csh_i, color = country)) +
geom_point(alpha = 0.5) +
geom_abline(se = FALSE) +
labs(
title = "Investment Share vs GDP Per Capita",
x = "GDP Per Capita",
y = "Investment Share of GDP (csh_i)"
) +
theme_minimal()
# Correlation Between GDP per Capita & Investment Share
ggplot(pwt, aes(rgdpcapita, csh_i, color = country)) +
geom_point(alpha = 0.5) +
geom_abline() +
labs(
title = "Investment Share vs GDP Per Capita",
x = "GDP Per Capita",
y = "Investment Share of GDP (csh_i)"
) +
theme_minimal()
# Correlation Between GDP per Capita & Investment Share
ggplot(pwt, aes(rgdpcapita, csh_i, color = country)) +
geom_point(alpha = 0.5) +
geom_smooth(method = "lm", se = FALSE, linewidth = 1) +
labs(
title = "Investment Share vs GDP Per Capita",
x = "GDP Per Capita",
y = "Investment Share of GDP (csh_i)"
) +
theme_minimal()
corr_df <- pwt %>%
select(rgdpcapita, ctfp, csh_i, growth) %>%
na.omit()
corr_matrix <- round(cor(corr_df), 2)
View(corr_df)
corr_matrix <- round(cor(corr_df), 2)
ggplot(melt(corr_matrix), aes(Var1, Var2, fill = value)) +
geom_tile() +
geom_text(aes(label = value), color = "white", size = 5) +
scale_fill_gradient2(low = "red", high = "blue", mid = "white") +
labs(
title = "Correlation Matrix (North America)",
x = "",
y = ""
) +
theme_minimal()
View(corr_df)
View(corr_df)
View(pwt)
corr_df <- pwt %>% filter(isocode = "USA") %>%
select(rgdpcapita, ctfp, csh_i, growth) %>%
na.omit()
corr_df <- pwt %>% filter(isocode == "USA") %>%
select(rgdpcapita, ctfp, csh_i, growth) %>%
na.omit()
View(corr_df)
corr_df <- pwt %>% filter(isocode == "USA") %>%
select(rgdpcapita, ctfp, csh_i, growth) %>%
na.omit() %>% ungroup()
corr_matrix <- round(cor(corr_df), 2)
corr_df <- pwt %>%
ungroup() %>%                       # <--- remove country grouping
select(rgdpcapita, ctfp, csh_i, growth) %>%
na.omit()
ggplot(melt(corr_matrix), aes(Var1, Var2, fill = value)) +
geom_tile() +
geom_text(aes(label = value), color = "white", size = 5) +
scale_fill_gradient2(low = "red", high = "blue", mid = "white") +
labs(
title = "Correlation Matrix (North America)",
x = "",
y = ""
) +
theme_minimal()
corr_matrix <- round(cor(corr_df), 2)
ggplot(melt(corr_matrix), aes(Var1, Var2, fill = value)) +
geom_tile() +
geom_text(aes(label = value), color = "white", size = 5) +
scale_fill_gradient2(low = "red", high = "blue", mid = "white") +
labs(
title = "Correlation Matrix (North America)",
x = "",
y = ""
) +
theme_minimal()
View(pwt)
corr_df <- pwt %>% filter(isocode == "USA") %>%
ungroup() %>%
select(rgdpcapita, ctfp, csh_i, growth) %>%
na.omit()
corr_matrix <- round(cor(corr_df), 2)
ggplot(melt(corr_matrix), aes(Var1, Var2, fill = value)) +
geom_tile() +
geom_text(aes(label = value), color = "white", size = 5) +
scale_fill_gradient2(low = "red", high = "blue", mid = "white") +
labs(
title = "Correlation Matrix (North America)",
x = "",
y = ""
) +
theme_minimal()
ggplot(pwt, aes(rgdpcapita, ctfp, color = country)) +
geom_point(alpha = 0.5) +
geom_smooth(se = FALSE) +
labs(
title = "TFP vs GDP Per Capita (Productivity Relationship)",
x = "GDP Per Capita",
y = "TFP (ctfp index)"
) +
theme_minimal()
ggplot(pwt, aes(rgdpcapita, ctfp, color = country)) +
geom_point(alpha = 0.5) +
geom_smooth(method = "lm") +
labs(
title = "TFP vs GDP Per Capita (Productivity Relationship)",
x = "GDP Per Capita",
y = "TFP (ctfp index)"
) +
theme_minimal()
ggplot(pwt, aes(ctfp, rgdpcapita, color = country)) +
geom_point(alpha = 0.5) +
geom_smooth(method = "lm") +
labs(
title = "TFP vs GDP Per Capita (Productivity Relationship)",
x = "GDP Per Capita",
y = "TFP (ctfp index)"
) +
theme_minimal()
ggplot(pwt, aes(rgdpcapita, ctfp, color = country)) +
geom_point(alpha = 0.5) +
geom_smooth(method = "lm") +
labs(
title = "TFP vs GDP Per Capita (Productivity Relationship)",
x = "GDP Per Capita",
y = "TFP (ctfp index)"
) +
theme_minimal()
rm(list=ls())
library(dplyr)
library(tidyverse)
library(lubridate)
library(data.table)
library(fixest)
library(modelsummary)
library(car)
data <- fread("clean_transactions.csv")
data <- data %>% filter(transyear >= 2000 & transyear <= 2023)
data <- data %>% rename("bkdpid" = `BKI Distinct Property ID (DPID)`)
parcel <- fread("Bkparcels.csv")
parcel <- parcel[!duplicated(parcel[, c(BKI.Distinct.Property.ID..DPID.)]), ]
parcel <- parcel %>% select(MEAN, Building.Area, Total.Number.of.Rooms, Number.of.Bedrooms, BKI.Distinct.Property.ID..DPID.) %>% rename("bkdpid" = BKI.Distinct.Property.ID..DPID.)
data <- data %>% left_join(parcel, by = "bkdpid")
data <- data %>% filter(!is.na(Number.of.Bedrooms))
data$bedroomPct <- ntile(data$Number.of.Bedrooms, 20)
data$roomsPct <- ntile(data$Total.Number.of.Rooms, 100)
data$coastalDistPct <- ntile(data$PhysicalDi, 100)
data$elevationPct <- ntile(data$Elevation, 100)
data$coastalDistPct2 <- ntile(data$PhysicalDi, 100)
data$elevationPct2 <- ntile(data$Elevation, 100)
data$yearmonth <-  format(as.Date(data$Recording.Date), "%b-%Y")
data$transmonth <- month(as.Date(data$Recording.Date))
data$continuousYear <- as.numeric(data$transyear) + as.numeric(data$transmonth/12)
data$houseagePct <- ntile(data$houseage, 100)
data$Building.Area2 <- (data$Building.Area)/1000
data$buildingAreaPct <- ntile(data$Building.Area2, 100)
data <- data %>% filter(Total.Number.of.Rooms != 0)
data <- data %>% filter(Number.of.Bedrooms != 0)
data <- data %>% rename("census" = `Property Address: Census Tract`) %>% filter(!is.na(census))
data$Recording.Date <- as.Date(data$Recording.Date)
#data$fe <- interaction(data$property_type, data$yrqtr, data$Property.Zip.Code, data$elevationPct2, data$coastalDistPct2)
rm(parcel)
data$nonlocal <- ifelse(data$`Buyer Mail: State` != "HI", 1, 0)
data$status1 <- ifelse(data$foreign == 1, "foreign",
ifelse(data$outstate == 1, "US", "HI"))
data$status2 <- ifelse(data$foreign == 1, "foreign",
ifelse(data$outstate == 1, "US", ifelse(data$outCounty == 1, "outcounty", "HI")))
data$status3 <- as.character(data$status1)
data$status3 <- ifelse(data$`Buyer Mail: State` == "CA", "CA", data$status3)
data$yearmonth <- paste0(data$transyear, "-", data$transmonth)
data$yearquarter <- paste0(year(data$Recording.Date), "-Q", quarter(data$Recording.Date))
#data$fe1 <- interaction(data$yearmonth, data$ZIP)
#data$fe2 <- interaction(data$yearmonth, data$ZIP, data$Number.of.Bedrooms, data$property_type)
#data$fe3 <- interaction(data$yearquarter, data$ZIP, data$Number.of.Bedrooms, data$property_type)
# Z X Y
data$fe1 <- paste0(data$yearmonth, "-", data$ZIP)
# Z x Y x B x P
data$fe2 <- paste0(data$yearmonth, "-", data$ZIP, "-", data$Number.of.Bedrooms, "-", data$property_type)
# Z x Y x B x P x C
data$fe3 <- paste0(data$yearmonth, "-", data$ZIP, "-", data$Number.of.Bedrooms, "-", data$property_type,
"-", data$coastalDistPct)
# Z x YQ x B x P x C
data$fe4 <- paste0(data$yearquarter, "-", data$ZIP, "-", data$Number.of.Bedrooms, "-", data$property_type, "-", data$coastalDistPct)
data$status1 <- relevel(factor(data$status1), ref = "HI")
data$status2 <- relevel(factor(data$status2), ref = "HI")
data$status3 <- relevel(factor(data$status3), ref = "HI")
rsAll <- data %>%
group_by(bkdpid) %>%
filter(n() == 2) %>%                             # keep groups with exactly two sales
arrange(bkdpid,Recording.Date ) %>%                        # ensure correct chronological order
filter(first(nonlocal) == 0 & last(nonlocal) == 1 | first(nonlocal) == 1 & last(nonlocal) == 0) %>%
ungroup()
rsAll$zipyear <- interaction(rsAll$continuousYear, rsAll$ZIP)
#data$fe4 <- paste0(data$yearmonth, "-", data$ZIP, "-", data$Number.of.Bedrooms, "-", data$property_type)
data$coastDist <- data$PhysicalDi/1609
breaks <- c(0, 0.25, 0.5, 0.75, 1, 2, 4, 18)
labels <- c("0-0.25", "0.25-0.5", "0.5-0.75", "0.75-1", "1-2", "2-4", "Inland")
data$coastdist_group <- cut(data$coastDist, breaks = breaks, labels = labels, include.lowest = TRUE)
#data <- data %>% filter(coastDist >= 2)
# No
model1 <- feols(log(Sales.Price) ~ nonlocal| elevationPct + buildingAreaPct + houseagePct, data = data,  cluster = "ZIP")
# Z x Y
model2 <- feols(log(Sales.Price) ~ nonlocal| elevationPct + buildingAreaPct + houseagePct + fe1, data = data, cluster = "ZIP")
# Z x Y x B x P
model3 <- feols(log(Sales.Price) ~ nonlocal| elevationPct + buildingAreaPct + houseagePct + fe2, data = data, cluster = "ZIP")
# Z x Y x B x P x C
model4 <- feols(log(Sales.Price) ~ nonlocal| elevationPct + buildingAreaPct + houseagePct + fe3, data = data, cluster = "ZIP")
# Z x YQ x B x P x C
model5 <- feols(log(Sales.Price) ~ nonlocal| elevationPct + buildingAreaPct + houseagePct + fe4, data = data, cluster = "ZIP")
# Repeat Sales
model6 <- feols(log(Sales.Price) ~ nonlocal |bkdpid + zipyear + yearmonth, data = rsAll,  cluster = "ZIP")
summary(model6)
models_main <- list(model1, model2, model3, model4, model5, model6)
msummary(models_main,  stars = c('*' = 0.10, '**' = 0.05, '***' = 0.01), gof_omit = "AIC|BIC|RMSE|Within")
#rm(model1, model2, model3, model4, model5, model6)
coef6 <- coef(model6)["nonlocal"]
se6   <- se(model6)["nonlocal"]
coef4 <- coef(model4)["nonlocal"]
se4   <- se(model4)["nonlocal"]
z_stat <- (coef6 - coef4) / sqrt(se6^2 + se4^2)
p_value <- 2 * (1 - pnorm(abs(z_stat)))
library(sf)
library(ggplot2)
library(units)
nonlocal_data <- data %>%
filter(nonlocal == 1)
nonlocal_sf <- nonlocal_data %>%
st_as_sf(coords = c("Property Address: Longitude", "Property Address: Latitiude"), crs = 4326)
# Read the coastline shapefile
coastline <- st_read("Coastline/Coastline.shp")
# Transform coastline to UTM for buffering
coastline_utm <- st_transform(coastline, 26904)
# Create 3-mile inward buffer (negative)
buffer_3mi_inland <- st_buffer(coastline_utm, dist = set_units(-3, "miles"))
# Convert buffer to line
inland_line <- st_boundary(buffer_3mi_inland)
# Ensure nonlocal_sf is in WGS84
nonlocal_sf <- st_transform(nonlocal_sf, 4326)
coastline <- st_transform(coastline, 4326)
inland_line <- st_transform(inland_line, 4326)
# Plot with coastline first
plot <- ggplot() +
geom_sf(data = coastline, color = "black", fill = NA, linewidth = 0.5) +
geom_sf(data = inland_line, color = "#0077B6", linetype = "dashed", linewidth = 0.5) +
geom_sf(data = nonlocal_sf, color = "#E63946", size = 0.2, alpha = 0.4) +
coord_sf(xlim = c(-159.9, -154.7), ylim = c(18.7, 22.3), expand = FALSE) +
labs(title = "Nonlocal Buyers") +
theme(
plot.title = element_text(hjust = 0.5),
panel.grid.major = element_line(color = "gray90"),
panel.background = element_rect(fill = "white"),
legend.position = "none"
)
rm(coastline, coastline_utm, buffer_3mi_inland,inland_line )
plot
library(sf)
library(ggplot2)
library(ggspatial)
library(viridis)
library(units)
library(dplyr)
# Filter non-local buyers
nonlocal_data <- data %>%
filter(nonlocal == 1)
# Convert to sf
nonlocal_sf <- nonlocal_data %>%
st_as_sf(coords = c("Property Address: Longitude", "Property Address: Latitiude"),
crs = 4326)
# Read coastline
coastline <- st_read("Coastline/Coastline.shp")
# Transform to UTM for buffering
coastline_utm <- st_transform(coastline, 26904)
# 3-mile inward buffer
buffer_3mi <- st_buffer(coastline_utm, dist = set_units(-3, "miles"))
inland_line <- st_boundary(buffer_3mi)
# Back to WGS84
coastline <- st_transform(coastline, 4326)
inland_line <- st_transform(inland_line, 4326)
#-------------------------------
#       Final Plot
#-------------------------------
p <- ggplot() +
# Background map layer (ESRI Satellite or OSM)
annotation_map_tile(type = "osm", zoom = 10) +
# Coastline
geom_sf(data = coastline, color = "black", fill = NA, linewidth = 0.4) +
# 3-mile inland line
geom_sf(data = inland_line,
aes(color = "3-mile inland buffer"),
linetype = "dashed", linewidth = 0.6) +
# **Density heat map of non-local buyers**
stat_density_2d_filled(
data = nonlocal_sf,
aes(x = st_coordinates(nonlocal_sf)[,1],
y = st_coordinates(nonlocal_sf)[,2],
fill = after_stat(level)),
geom = "polygon",
alpha = 0.7,
contour_var = "density"
) +
scale_fill_viridis_c(option = "inferno", name = "Buyer Density") +
# Custom color for the inland buffer
scale_color_manual(values = c("3-mile inland buffer" = "#0077B6"), name = "") +
coord_sf(
xlim = c(-159.9, -154.7),
ylim = c(18.7, 22.3),
expand = FALSE
) +
labs(
title = "Nonlocal Buyer Density and 3-Mile Inland Buffer",
subtitle = "Heatmap of non-local property buyers across Hawaiâ€˜i",
x = NULL, y = NULL
) +
theme_minimal(base_size = 13) +
theme(
legend.position = "right",
plot.title = element_text(hjust = 0.5, face = "bold", size = 16),
plot.subtitle = element_text(hjust = 0.5),
panel.grid = element_blank()
)
p
p <- ggplot() +
# Background map layer (ESRI Satellite or OSM)
annotation_map_tile(type = "osm", zoom = 10) +
# Coastline
geom_sf(data = coastline, color = "black", fill = NA, linewidth = 0.4) +
# 3-mile inland line
geom_sf(data = inland_line,
aes(color = "3-mile inland buffer"),
linetype = "dashed", linewidth = 0.6) +
# **Density heat map of non-local buyers**
stat_density_2d_filled(
data = nonlocal_sf,
aes(x = st_coordinates(nonlocal_sf)[,1],
y = st_coordinates(nonlocal_sf)[,2],
fill = after_stat(level)),
geom = "polygon",
alpha = 0.7,
contour_var = "density"
) +
scale_fill_viridis_d(option = "inferno", name = "Buyer Density")+
# Custom color for the inland buffer
scale_color_manual(values = c("3-mile inland buffer" = "#0077B6"), name = "") +
coord_sf(
xlim = c(-159.9, -154.7),
ylim = c(18.7, 22.3),
expand = FALSE
) +
labs(
title = "Nonlocal Buyer Density and 3-Mile Inland Buffer",
subtitle = "Heatmap of non-local property buyers across Hawaiâ€˜i",
x = NULL, y = NULL
) +
theme_minimal(base_size = 13) +
theme(
legend.position = "right",
plot.title = element_text(hjust = 0.5, face = "bold", size = 16),
plot.subtitle = element_text(hjust = 0.5),
panel.grid = element_blank()
)
p
install.packages("prettymapr")
library(prettymapr)
p
library(sf)
library(ggplot2)
library(ggspatial)
library(units)
library(dplyr)
# Filter nonlocal buyers
nonlocal_data <- data %>%
filter(nonlocal == 1)
# Convert to sf
nonlocal_sf <- nonlocal_data %>%
st_as_sf(coords = c("Property Address: Longitude",
"Property Address: Latitiude"),
crs = 4326)
# Read coastline
coastline <- st_read("Coastline/Coastline.shp")
# Transform for buffer
coastline_utm <- st_transform(coastline, 26904)
# 3-mile inland buffer
buffer_3mi_inland <- st_buffer(coastline_utm, dist = set_units(-3, "miles"))
inland_line <- st_boundary(buffer_3mi_inland)
# Back to WGS84
coastline <- st_transform(coastline, 4326)
inland_line <- st_transform(inland_line, 4326)
# ------------------------------------------------
#     Improved plot (same as your style)
# ------------------------------------------------
plot <- ggplot() +
# ðŸ”µ Background basemap
s
annotation_map_tile(type = "osm", zoom = 10) +
sd
